<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="telegram:use_fullscreen" content="true">
    
    <title>üå∏ Dream Lady - –≠–ª–∏—Ç–Ω–∞—è —Å—Ç—É–¥–∏—è —Ñ–∏—Ç–Ω–µ—Å–∞ –∏ —Ç–∞–Ω—Ü–µ–≤</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@300;400;500;600&family=Inter:wght@200;300;400;500&display=swap" rel="stylesheet">
    
    <style>
        /* –í–ê–® –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô CSS –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        :root {
            --gold: #C6A16E;
            --deep-navy: #1A1F2B;
            --soft-white: #F8F5F2;
            --light-gold: #E8D9C5;
            --graphite: #2A2F3B;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', sans-serif;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            background: var(--deep-navy);
            color: var(--soft-white);
            min-height: 100vh;
            padding: 10px;
            display: block;
            overflow-x: hidden;
            position: relative;
        }
        
        /* –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .stars-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background: #C6A16E;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .gloss-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                125deg,
                transparent 0%,
                rgba(198, 161, 110, 0.1) 40%,
                rgba(232, 216, 197, 0.2) 50%,
                rgba(198, 161, 110, 0.1) 60%,
                transparent 100%
            );
            z-index: 2;
            pointer-events: none;
        }
        
        /* –í–∞—à –æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .menu-container {
            width: 100%;
            max-width: 400px;
            background: rgba(26, 31, 43, 0.95);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 25px 60px rgba(198, 161, 110, 0.3);
            border: 2px solid var(--gold);
            margin: 0 auto;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 10;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞... */
        
        /* =========================================== */
        /* –°–¢–ò–õ–ò –î–õ–Ø –§–ò–¢–ù–ï–°-–¢–†–ï–ö–ï–†–ê (–û–ë–ù–û–í–õ–ï–ù–ù–´–ï) */
        /* =========================================== */
        
        .fitness-tracker-modal {
            max-width: 420px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            background: rgba(26, 31, 43, 0.95);
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(198, 161, 110, 0.4);
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .fitness-tracker-modal {
            transform: translateY(0);
        }
        
        .tracker-title {
            font-family: 'Cormorant', serif;
            font-size: 24px;
            font-weight: 500;
            color: var(--gold);
            text-align: center;
            margin-bottom: 25px;
            letter-spacing: 1px;
        }
        
        .tracker-status-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px 15px;
            background: rgba(198, 161, 110, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(198, 161, 110, 0.2);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-active {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        
        .status-paused {
            background: #FF9800;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }
        
        .status-gps-active {
            background: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }
        
        .status-text {
            flex: 1;
            font-size: 14px;
            color: var(--light-gold);
        }
        
        .step-counter-large {
            font-size: 72px;
            font-family: 'Cormorant', serif;
            font-weight: 300;
            color: var(--gold);
            text-align: center;
            margin: 20px 0;
            text-shadow: 0 5px 15px rgba(198, 161, 110, 0.5);
            line-height: 1;
        }
        
        .step-label {
            font-size: 16px;
            color: var(--light-gold);
            text-align: center;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 25px 0;
        }
        
        .stat-box {
            background: rgba(198, 161, 110, 0.05);
            border: 1px solid rgba(198, 161, 110, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-family: 'Cormorant', serif;
            color: var(--gold);
            display: block;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .stat-label-small {
            font-size: 11px;
            color: var(--light-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .goal-container {
            margin: 20px 0;
            padding: 15px;
            background: rgba(198, 161, 110, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(198, 161, 110, 0.2);
        }
        
        .goal-text {
            font-size: 14px;
            color: var(--light-gold);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(198, 161, 110, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #C6A16E, #D4AF37);
            border-radius: 5px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .goal-percentage {
            font-size: 12px;
            color: var(--gold);
            text-align: right;
            font-weight: 500;
        }
        
        .controls-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 25px 0;
        }
        
        .control-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-family: 'Cormorant', serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        }
        
        .control-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2);
        }
        
        .control-button.start {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        
        .control-button.pause {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
        }
        
        .control-button.reset {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
        
        .timer-display {
            font-size: 20px;
            color: var(--gold);
            text-align: center;
            margin: 15px 0;
            font-family: 'Cormorant', serif;
            font-weight: 500;
        }
        
        .tracker-info {
            background: rgba(33, 150, 243, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(33, 150, 243, 0.3);
            text-align: center;
        }
        
        .tracker-info-text {
            font-size: 13px;
            color: var(--light-gold);
            line-height: 1.5;
        }
        
        .tracker-info-text strong {
            color: #2196F3;
        }
        
        .tracker-warning {
            background: rgba(255, 100, 100, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 100, 100, 0.3);
            text-align: center;
        }
        
        .tracker-warning-text {
            font-size: 12px;
            color: var(--light-gold);
            line-height: 1.5;
        }
        
        .tracker-warning-text strong {
            color: #ff6b6b;
        }
        
        .gps-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .gps-icon {
            font-size: 20px;
        }
        
        .gps-text {
            font-size: 12px;
            color: var(--light-gold);
        }
        
        .permission-button {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            margin: 5px;
            width: 100%;
            box-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .permission-button:active {
            transform: translateY(1px);
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2);
        }
        
        .location-info {
            font-size: 11px;
            color: var(--light-gold);
            text-align: center;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .accuracy-info {
            font-size: 10px;
            color: var(--light-gold);
            text-align: center;
            margin-top: 3px;
            opacity: 0.6;
        }
        
        .daily-stats {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(198, 161, 110, 0.2);
        }
        
        .daily-stats-title {
            font-family: 'Cormorant', serif;
            font-size: 16px;
            color: var(--gold);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .daily-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .daily-stat-item {
            text-align: center;
            padding: 8px;
            background: rgba(198, 161, 110, 0.05);
            border-radius: 8px;
        }
        
        .daily-stat-value {
            font-size: 14px;
            color: var(--gold);
            font-weight: 500;
            display: block;
        }
        
        .daily-stat-label {
            font-size: 9px;
            color: var(--light-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }
        
        .map-preview {
            height: 150px;
            background: rgba(26, 31, 43, 0.8);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(198, 161, 110, 0.2);
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: var(--light-gold);
            font-size: 14px;
        }
        
        .map-placeholder-icon {
            font-size: 40px;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .route-distance {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(26, 31, 43, 0.9);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: var(--gold);
            border: 1px solid var(--gold);
        }
    </style>
</head>
<body class="telegram-miniapp-fix">
    <!-- –ú–µ—Ä—Ü–∞—é—â–∏–µ –∑–≤–µ–∑–¥–æ—á–∫–∏ -->
    <div class="stars-background" id="stars"></div>
    <div class="gloss-overlay"></div>
        
    <div class="menu-container">
        <!-- –®–ê–ü–ö–ê –í –°–¢–ò–õ–ï –°–ê–ô–¢–ê -->
        <div class="header">
            <div class="logo-container"></div>
            <h1>Dream Lady</h1>
            <div class="subtitle">
                –≠–ª–∏—Ç–Ω–∞—è —Å—Ç—É–¥–∏—è –ø—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏—è
            </div>
        </div>
        
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ô -->
        <div class="directions-stats">
            <div class="stat-item">
                <span class="stat-number">12</span>
                <span class="stat-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">500+</span>
                <span class="stat-label">–í—ã–ø—É—Å–∫–Ω–∏—Ü</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">5‚òÖ</span>
                <span class="stat-label">–†–µ–π—Ç–∏–Ω–≥</span>
            </div>
        </div>
        
        <!-- –ö–ù–û–ü–ö–ò –í –ù–û–í–û–ú –ü–û–†–Ø–î–ö–ï -->
        <div class="button-3d" onclick="openLink('https://an9655.listokcrm.ru/wapi')">
            <div class="button-title">ü©∞ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
        </div>
        
        <div class="button-3d" onclick="openLink('https://dream-lady.com')">
            <div class="button-title">üåê –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç</div>
        </div>
        
        <div class="button-3d" onclick="openStockModal()">
            <div class="button-title">üéÄ –ê–∫—Ü–∏–∏</div>
        </div>
        
        <div class="button-3d" onclick="openDirectionsModal()">
            <div class="button-title">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–∏–∏</div>
        </div>
        
        <div class="button-3d" onclick="openTestModal()">
            <div class="button-title">–ù–∞–π–¥–∏ —Å–≤–æ—ë –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
        </div>
        
        <div class="button-3d" onclick="openTrainersModal()">
            <div class="button-title">–ù–∞—à–∏ —Ç—Ä–µ–Ω–µ—Ä—ã</div>
        </div>
        
        <div class="button-3d" onclick="openPriceModal()">
            <div class="button-title">–£–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
        </div>
        
        <!-- –ö–ù–û–ü–ö–ê –§–ò–¢–ù–ï–°-–¢–†–ï–ö–ï–†–ê (–î–û–ë–ê–í–õ–ï–ù–ê –ü–û–°–õ–ï –†–ï–ô–¢–ò–ù–ì–ê) -->
        <div class="button-3d" onclick="openFitnessTracker()">
            <div class="button-title">üèÉ –§–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä</div>
        </div>
        
        <div class="button-3d" onclick="openSignupModal()">
            <div class="button-title">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞–Ω—è—Ç–∏—è</div>
        </div>
        
        <div class="button-3d" onclick="openTelegramBotFullscreen()">
            <div class="button-title">ü§ñ Telegram-–±–æ—Ç</div>
        </div>
        
        <div class="button-3d" onclick="openContactsModal()">
            <div class="button-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        </div>
        
        <!-- –ü–û–î–í–ê–õ –° –°–û–¶–°–ï–¢–Ø–ú–ò -->
        <div class="footer">
            <strong>DREAM LADY</strong>
            –≠–ª–∏—Ç–Ω–∞—è —Å—Ç—É–¥–∏—è —Ñ–∏—Ç–Ω–µ—Å–∞ –∏ —Ç–∞–Ω—Ü–µ–≤ ¬© 2025<br>
            –°–∞–º–∞—è —Ä–æ—Å–∫–æ—à–Ω–∞—è —Å—Ç—É–¥–∏—è –≥–æ—Ä–æ–¥–∞
            
            <!-- –°–û–¶–°–ï–¢–ò -->
            <div class="social-links">
                <a href="https://t.me/DreamLady_Koroleva" class="social-link" onclick="openLink('https://t.me/DreamLady_Koroleva'); return false;" title="Telegram">
                    <span>‚úàÔ∏è</span>
                </a>
                <a href="https://api.whatsapp.com/send/?phone=79169947368" class="social-link" onclick="openLink('https://api.whatsapp.com/send/?phone=79169947368'); return false;" title="WhatsApp">
                    <span>üì±</span>
                </a>
                <a href="https://vk.com/dream_lady_studio" class="social-link" onclick="openLink('https://vk.com/dream_lady_studio'); return false;" title="–í–ö–æ–Ω—Ç–∞–∫—Ç–µ">
                    <span>VK</span>
                </a>
                <a href="https://ok.ru/group/70000036908725" class="social-link" onclick="openLink('https://ok.ru/group/70000036908725'); return false;" title="–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏">
                    <span>OK</span>
                </a>
                <a href="https://dzen.ru/dream_lady" class="social-link" onclick="openLink('https://dzen.ru/dream_lady'); return false;" title="–î–∑–µ–Ω">
                    <span>–î</span>
                </a>
                <a href="https://yandex.ru/map-widget/v1/?z=12&ol=biz&oid=86436673865" class="social-link" onclick="openLink('https://yandex.ru/map-widget/v1/?z=12&ol=biz&oid=86436673865'); return false;" title="–Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã">
                    <span>üó∫Ô∏è</span>
                </a>
                <a href="https://www.tiktok.com/@dream_lady_studio?_r=1" class="social-link" onclick="openLink('https://www.tiktok.com/@dream_lady_studio?_r=1'); return false;" title="TikTok">
                    <span>üéµ</span>
                </a>
            </div>
        </div>
    </div>
        <!-- –ë–õ–û–ö –†–ê–°–ü–ò–°–ê–ù–ò–Ø –ü–û–î –ú–ï–ù–Æ -->
    <div class="schedule-notification">
        <strong>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</strong>
    </div>
    <!-- WAPI –°–ö–†–ò–ü–¢ –ü–û–î –ú–ï–ù–Æ (–∫–∞–∫ –≤—ã –ø—Ä–æ—Å–∏–ª–∏) -->
    <script src="https://intgr91afda9e057d0c742cda59a22cd5bdf4.listokcrm.ru/wapi/script"></script>
    <div id="listokWidgetContainer"></div>
    
    <!-- =========================================== -->
    <!-- –û–ö–ù–û –§–ò–¢–ù–ï–°-–¢–†–ï–ö–ï–†–ê (–û–ë–ù–û–í–õ–ï–ù–ù–û–ï) -->
    <!-- =========================================== -->
    <div id="fitnessTrackerModal" class="modal-overlay">
        <div class="fitness-tracker-modal">
            <div class="modal-close" onclick="closeFitnessTracker()">√ó</div>
            <h2 class="tracker-title">üèÉ –§–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä Dream Lady</h2>
            
            <!-- –°–¢–ê–¢–£–° -->
            <div class="tracker-status-container">
                <div class="status-indicator" id="statusIndicator"></div>
                <div class="status-text" id="statusText">
                    –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
                </div>
            </div>
            
            <!-- GPS –°–¢–ê–¢–£–° -->
            <div class="gps-status">
                <div class="gps-icon">üìç</div>
                <div class="gps-text" id="gpsStatusText">GPS: –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</div>
            </div>
            
            <!-- –°–ß–ï–¢–ß–ò–ö –®–ê–ì–û–í -->
            <div class="step-label">–®–∞–≥–∏ —Å–µ–∞–Ω—Å–∞</div>
            <div class="step-counter-large" id="stepCounter">0</div>
            
            <!-- –¢–ê–ô–ú–ï–† -->
            <div class="timer-display" id="timerDisplay">00:00:00</div>
            
            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="stats-container">
                <div class="stat-box">
                    <span class="stat-value" id="distanceValue">0.00</span>
                    <span class="stat-label-small">–ö–∏–ª–æ–º–µ—Ç—Ä—ã</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="paceValue">0:00</span>
                    <span class="stat-label-small">–¢–µ–º–ø –º–∏–Ω/–∫–º</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="caloriesValue">0</span>
                    <span class="stat-label-small">–ö–∞–ª–æ—Ä–∏–∏</span>
                </div>
            </div>
            
            <!-- –ö–ù–û–ü–ö–ò –†–ê–ó–†–ï–®–ï–ù–ò–ô -->
            <div id="permissionButtons" style="display: none;">
                <button class="permission-button" onclick="requestGeolocationPermission()">
                    üìç –†–∞–∑—Ä–µ—à–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
                </button>
                <p class="location-info">–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ GPS</p>
            </div>
            
            <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ì–ï–û–õ–û–ö–ê–¶–ò–ò -->
            <div class="tracker-info">
                <div class="tracker-info-text">
                    <strong>üìç –†–µ–∂–∏–º GPS-—Ç—Ä–µ–∫–∏–Ω–≥–∞:</strong><br>
                    ‚Ä¢ –î–∏—Å—Ç–∞–Ω—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—é<br>
                    ‚Ä¢ –ê–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏<br>
                    ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å GPS: <span id="gpsAccuracy">-</span> –º–µ—Ç—Ä–æ–≤
                </div>
            </div>
            
            <!-- –ü–†–ï–î–ü–†–û–°–ú–û–¢–† –ö–ê–†–¢–´ -->
            <div class="map-preview" id="mapPreview">
                <div class="map-placeholder">
                    <div class="map-placeholder-icon">üó∫Ô∏è</div>
                    <div>–ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
                <div class="route-distance" id="routeDistance" style="display: none;">0.00 –∫–º</div>
            </div>
            
            <!-- –¶–ï–õ–¨ -->
            <div class="goal-container">
                <div class="goal-text">–¶–µ–ª—å —Å–µ–∞–Ω—Å–∞: <strong id="sessionGoal">5.00</strong> –∫–º</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="goal-percentage" id="goalPercentage">0%</div>
            </div>
            
            <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï -->
            <div class="controls-container">
                <button class="control-button start" onclick="startTracker()" id="startButton">–°—Ç–∞—Ä—Ç</button>
                <button class="control-button pause" onclick="pauseTracker()" id="pauseButton" disabled>–ü–∞—É–∑–∞</button>
                <button class="control-button reset" onclick="resetTracker()">–°–±—Ä–æ—Å</button>
            </div>
            
            <!-- –î–ù–ï–í–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="daily-stats">
                <div class="daily-stats-title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="daily-stats-grid">
                    <div class="daily-stat-item">
                        <span class="daily-stat-value" id="totalDistance">0.00</span>
                        <span class="daily-stat-label">–í—Å–µ–≥–æ –∫–º</span>
                    </div>
                    <div class="daily-stat-item">
                        <span class="daily-stat-value" id="totalTime">0:00</span>
                        <span class="daily-stat-label">–í—Ä–µ–º—è</span>
                    </div>
                    <div class="daily-stat-item">
                        <span class="daily-stat-value" id="totalCalories">0</span>
                        <span class="daily-stat-label">–ö–∫–∞–ª</span>
                    </div>
                </div>
            </div>
            
            <!-- –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï -->
            <div class="tracker-warning">
                <div class="tracker-warning-text">
                    <strong>‚ö†Ô∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:</strong><br>
                    1. –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏<br>
                    2. GPS —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –Ω–µ–±–∞<br>
                    3. –í –ø–æ–º–µ—â–µ–Ω–∏–∏ —Ç–æ—á–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è<br>
                    4. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º
                </div>
            </div>
        </div>
    </div>
    
    <!-- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—à–∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    
<script>
// ============================================
// MINI APPS 2.0: –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –†–ï–ñ–ò–ú
// ============================================

console.log('üöÄ Dream Lady Mini Apps 2.0 –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...');

// –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM
if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    const tg = Telegram.WebApp;
    
    // 1. –ê–ö–¢–ò–í–ê–¶–ò–Ø
    tg.ready();
    
    // 2. –í–ö–õ–Æ–ß–ê–ï–ú –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –†–ï–ñ–ò–ú
    tg.expand();
    
    // 3. –û–¢–ö–õ–Æ–ß–ê–ï–ú –°–í–ê–ô–ü–´ –í–ù–ò–ó
    tg.disableVerticalSwipes();
    
    // 4. –°–ö–†–´–í–ê–ï–ú –ö–ù–û–ü–ö–£ "–ù–ê–ó–ê–î"
    tg.BackButton.hide();
    
    // 5. –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú –¶–í–ï–¢–ê
    tg.setHeaderColor('#1A1F2B');
    tg.setBackgroundColor('#1A1F2B');
    
    console.log('‚úÖ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    console.log('üì± –í–µ—Ä—Å–∏—è:', tg.version);
    
} else {
    console.log('üåê –†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞');
}

// ============================================
// –§–£–ù–ö–¶–ò–ò –§–ò–¢–ù–ï–°-–¢–†–ï–ö–ï–†–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
// ============================================

let trackerState = {
    isTracking: false,
    hasGeolocation: false,
    sessionSteps: 0,
    sessionDistance: 0, // –í –º–µ—Ç—Ä–∞—Ö
    sessionCalories: 0,
    startTime: null,
    currentTime: 0,
    timerInterval: null,
    watchId: null,
    routePoints: [],
    lastPosition: null,
    isHighAccuracy: false,
    activityDetected: false,
    lastActivityTime: 0
};

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATIONS = {
    stepLength: 0.67, // —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —à–∞–≥–∞ –∂–µ–Ω—â–∏–Ω—ã (–º–µ—Ç—Ä—ã)
    caloriesPerKm: 60, // –∫–∫–∞–ª –Ω–∞ –∫–º –ø—Ä–∏ —Ö–æ–¥—å–±–µ
    minDistanceForStep: 0.5, // –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–ª—è –∑–∞—á–µ—Ç–∞ —à–∞–≥–∞ (–º–µ—Ç—Ä—ã)
    sessionGoal: 5000, // —Ü–µ–ª—å —Å–µ–∞–Ω—Å–∞ –≤ –º–µ—Ç—Ä–∞—Ö (5 –∫–º)
    activityThreshold: 1.2, // –ø–æ—Ä–æ–≥ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    inactivityTimeout: 3000 // –≤—Ä–µ–º—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –º—Å
};

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
function loadTrackerData() {
    const saved = localStorage.getItem('dreamLadyFitnessTrackerV2');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            const today = new Date().toDateString();
            
            if (data.date === today) {
                trackerState.sessionSteps = data.sessionSteps || 0;
                trackerState.sessionDistance = data.sessionDistance || 0;
                trackerState.sessionCalories = data.sessionCalories || 0;
                trackerState.routePoints = data.routePoints || [];
                if (data.lastPosition) trackerState.lastPosition = data.lastPosition;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
                if (trackerState.routePoints.length > 0) {
                    const firstPoint = trackerState.routePoints[0];
                    const lastPoint = trackerState.routePoints[trackerState.routePoints.length - 1];
                    trackerState.currentTime = Math.floor((lastPoint.timestamp - firstPoint.timestamp) / 1000);
                }
            }
        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
        }
    }
    updateTrackerDisplay();
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
function saveTrackerData() {
    const data = {
        date: new Date().toDateString(),
        sessionSteps: trackerState.sessionSteps,
        sessionDistance: trackerState.sessionDistance,
        sessionCalories: trackerState.sessionCalories,
        routePoints: trackerState.routePoints,
        lastPosition: trackerState.lastPosition
    };
    localStorage.setItem('dreamLadyFitnessTrackerV2', JSON.stringify(data));
}

// –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
function requestGeolocationPermission() {
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.requestLocation().then(granted => {
            if (granted) {
                initGeolocation();
            } else {
                updateGPSStatus('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', false);
                showPermissionButtons();
            }
        }).catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error);
            updateGPSStatus('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞', false);
            showPermissionButtons();
        });
    } else {
        // –î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                () => initGeolocation(),
                () => {
                    updateGPSStatus('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', false);
                    showPermissionButtons();
                },
                { enableHighAccuracy: true }
            );
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
function initGeolocation() {
    trackerState.hasGeolocation = true;
    updateGPSStatus('GPS –∞–∫—Ç–∏–≤–µ–Ω', true);
    document.getElementById('permissionButtons').style.display = 'none';
    
    if (trackerState.isTracking) {
        startGeoTracking();
    }
}

// –ó–∞–ø—É—Å–∫ GPS-—Ç—Ä–µ–∫–∏–Ω–≥–∞
function startGeoTracking() {
    if (!trackerState.hasGeolocation) return;
    
    const options = {
        enableHighAccuracy: true,
        maximumAge: 3000,
        timeout: 5000
    };
    
    if (navigator.geolocation) {
        trackerState.watchId = navigator.geolocation.watchPosition(
            handlePositionUpdate,
            handlePositionError,
            options
        );
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –¥–µ—Ç–µ–∫—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä
    startActivityDetection();
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
function handlePositionUpdate(position) {
    const accuracy = position.coords.accuracy;
    const isGoodAccuracy = accuracy < 50; // –•–æ—Ä–æ—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å - –º–µ–Ω–µ–µ 50 –º–µ—Ç—Ä–æ–≤
    
    trackerState.isHighAccuracy = isGoodAccuracy;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ—á–Ω–æ—Å—Ç–∏
    document.getElementById('gpsAccuracy').textContent = Math.round(accuracy);
    
    const newPoint = {
        lat: position.coords.latitude,
        lng: position.coords.longitude,
        accuracy: accuracy,
        timestamp: Date.now(),
        speed: position.coords.speed || 0
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –≤ –º–∞—Ä—à—Ä—É—Ç
    trackerState.routePoints.push(newPoint);
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ç–æ—á–∫–∞
    if (trackerState.lastPosition && isGoodAccuracy) {
        const distance = calculateDistance(
            trackerState.lastPosition.lat,
            trackerState.lastPosition.lng,
            newPoint.lat,
            newPoint.lng
        );
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º —à—É–º GPS - —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
        if (distance > CALCULATIONS.minDistanceForStep) {
            trackerState.sessionDistance += distance;
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –º–µ—Ç—Ä—ã –≤ —à–∞–≥–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ)
            const steps = Math.round(distance / CALCULATIONS.stepLength);
            trackerState.sessionSteps += steps;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–∞–ª–æ—Ä–∏–∏
            trackerState.sessionCalories = Math.round(
                (trackerState.sessionDistance / 1000) * CALCULATIONS.caloriesPerKm
            );
            
            updateTrackerDisplay();
            saveTrackerData();
            updateMapPreview();
        }
    }
    
    trackerState.lastPosition = {
        lat: newPoint.lat,
        lng: newPoint.lng
    };
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ GPS
function handlePositionError(error) {
    let message = '–û—à–∏–±–∫–∞ GPS: ';
    switch(error.code) {
        case error.PERMISSION_DENIED:
            message += '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω';
            trackerState.hasGeolocation = false;
            showPermissionButtons();
            break;
        case error.POSITION_UNAVAILABLE:
            message += '–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã';
            break;
        case error.TIMEOUT:
            message += '–¢–∞–π–º–∞—É—Ç';
            break;
        default:
            message += '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
            break;
    }
    updateGPSStatus(message, false);
}

// –î–µ—Ç–µ–∫—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ö–æ–¥—å–±—ã)
function startActivityDetection() {
    if (typeof DeviceMotionEvent !== 'undefined') {
        let lastAcceleration = null;
        let activityCount = 0;
        
        const motionHandler = (event) => {
            if (!trackerState.isTracking) return;
            
            const accel = event.accelerationIncludingGravity || 
                         event.acceleration || 
                         { x: 0, y: 0, z: 0 };
            
            const totalAccel = Math.sqrt(
                accel.x * accel.x + 
                accel.y * accel.y + 
                accel.z * accel.z
            );
            
            if (lastAcceleration !== null) {
                const delta = Math.abs(totalAccel - lastAcceleration);
                
                // –§–∏–∫—Å–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
                if (delta > CALCULATIONS.activityThreshold) {
                    trackerState.activityDetected = true;
                    trackerState.lastActivityTime = Date.now();
                    activityCount++;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 10 –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
                    if (activityCount % 10 === 0) {
                        updateStatus('–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞', 'status-active');
                    }
                }
            }
            
            lastAcceleration = totalAccel;
        };
        
        window.addEventListener('devicemotion', motionHandler);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        setInterval(() => {
            if (trackerState.isTracking && 
                trackerState.activityDetected && 
                Date.now() - trackerState.lastActivityTime > CALCULATIONS.inactivityTimeout) {
                trackerState.activityDetected = false;
                updateStatus('–û–∂–∏–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏', 'status-paused');
            }
        }, 1000);
    }
}

// –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ (—Ñ–æ—Ä–º—É–ª–∞ –≥–∞–≤–µ—Ä—Å–∏–Ω—É—Å–æ–≤)
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371000; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
              Math.sin(dLon/2) * Math.sin(dLon/2);
    
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function toRad(degrees) {
    return degrees * (Math.PI/180);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ä—Ç—ã
function updateMapPreview() {
    if (trackerState.routePoints.length > 1) {
        const distanceKm = (trackerState.sessionDistance / 1000).toFixed(2);
        document.getElementById('routeDistance').textContent = distanceKm + ' –∫–º';
        document.getElementById('routeDistance').style.display = 'block';
        
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —á–µ—Ä–µ–∑ Leaflet –∏–ª–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
        // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ GPS
function updateGPSStatus(text, isActive) {
    const statusEl = document.getElementById('gpsStatusText');
    statusEl.textContent = 'GPS: ' + text;
    statusEl.style.color = isActive ? '#4CAF50' : '#FF9800';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
function updateStatus(text, statusClass) {
    const indicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    
    indicator.className = 'status-indicator ' + statusClass;
    statusText.textContent = text;
}

// –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
function showPermissionButtons() {
    document.getElementById('permissionButtons').style.display = 'block';
}

// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–µ–∫–µ—Ä–∞
function openFitnessTracker() {
    document.getElementById('fitnessTrackerModal').classList.add('active');
    loadTrackerData();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
    if (!trackerState.hasGeolocation) {
        showPermissionButtons();
    }
    
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeFitnessTracker);
    }
}

function closeFitnessTracker() {
    document.getElementById('fitnessTrackerModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function startTracker() {
    if (trackerState.isTracking) return;
    
    trackerState.isTracking = true;
    trackerState.startTime = Date.now() - (trackerState.currentTime * 1000);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
    startTimer();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º GPS –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    if (trackerState.hasGeolocation) {
        startGeoTracking();
        updateStatus('GPS-—Ç—Ä–µ–∫–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω', 'status-gps-active');
    } else {
        updateStatus('–û–∂–∏–¥–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏', 'status-paused');
        showPermissionButtons();
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    document.getElementById('startButton').disabled = true;
    document.getElementById('pauseButton').disabled = false;
    
    console.log('üèÉ –¢—Ä–µ–∫–µ—Ä –∑–∞–ø—É—â–µ–Ω (GPS —Ä–µ–∂–∏–º)');
}

function pauseTracker() {
    if (!trackerState.isTracking) return;
    
    trackerState.isTracking = false;
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
    stopTimer();
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º GPS
    if (trackerState.watchId && navigator.geolocation) {
        navigator.geolocation.clearWatch(trackerState.watchId);
        trackerState.watchId = null;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    saveTrackerData();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    updateStatus('–¢—Ä–µ–∫–µ—Ä –Ω–∞ –ø–∞—É–∑–µ', 'status-paused');
    document.getElementById('startButton').disabled = false;
    document.getElementById('pauseButton').disabled = true;
    
    console.log('‚è∏ –¢—Ä–µ–∫–µ—Ä –Ω–∞ –ø–∞—É–∑–µ');
}

function resetTracker() {
    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É? –í–µ—Å—å –º–∞—Ä—à—Ä—É—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.')) {
        trackerState.isTracking = false;
        trackerState.sessionSteps = 0;
        trackerState.sessionDistance = 0;
        trackerState.sessionCalories = 0;
        trackerState.startTime = null;
        trackerState.currentTime = 0;
        trackerState.routePoints = [];
        trackerState.lastPosition = null;
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ
        stopTimer();
        if (trackerState.watchId && navigator.geolocation) {
            navigator.geolocation.clearWatch(trackerState.watchId);
            trackerState.watchId = null;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º
        saveTrackerData();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        updateTrackerDisplay();
        updateStatus('–¢—Ä–µ–∫–µ—Ä —Å–±—Ä–æ—à–µ–Ω', '');
        document.getElementById('startButton').disabled = false;
        document.getElementById('pauseButton').disabled = true;
        document.getElementById('routeDistance').style.display = 'none';
        
        console.log('üîÑ –¢—Ä–µ–∫–µ—Ä —Å–±—Ä–æ—à–µ–Ω');
    }
}

// –¢–∞–π–º–µ—Ä
function startTimer() {
    if (trackerState.timerInterval) clearInterval(trackerState.timerInterval);
    
    trackerState.timerInterval = setInterval(() => {
        trackerState.currentTime = Math.floor((Date.now() - trackerState.startTime) / 1000);
        updateTimerDisplay();
        saveTrackerData();
    }, 1000);
}

function stopTimer() {
    if (trackerState.timerInterval) {
        clearInterval(trackerState.timerInterval);
        trackerState.timerInterval = null;
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateTrackerDisplay() {
    // –®–∞–≥–∏
    document.getElementById('stepCounter').textContent = trackerState.sessionSteps.toLocaleString();
    
    // –î–∏—Å—Ç–∞–Ω—Ü–∏—è –≤ –∫–º
    const distanceKm = (trackerState.sessionDistance / 1000).toFixed(2);
    document.getElementById('distanceValue').textContent = distanceKm;
    
    // –¢–µ–º–ø (–º–∏–Ω/–∫–º)
    let pace = '0:00';
    if (trackerState.sessionDistance > 0 && trackerState.currentTime > 0) {
        const paceSeconds = (trackerState.currentTime * 1000) / (trackerState.sessionDistance / 1000);
        const paceMinutes = Math.floor(paceSeconds / 60);
        const paceSecs = Math.floor(paceSeconds % 60);
        pace = `${paceMinutes}:${paceSecs.toString().padStart(2, '0')}`;
    }
    document.getElementById('paceValue').textContent = pace;
    
    // –ö–∞–ª–æ—Ä–∏–∏
    document.getElementById('caloriesValue').textContent = trackerState.sessionCalories;
    
    // –¶–µ–ª—å —Å–µ–∞–Ω—Å–∞
    document.getElementById('sessionGoal').textContent = (CALCULATIONS.sessionGoal / 1000).toFixed(2);
    const progress = Math.min((trackerState.sessionDistance / CALCULATIONS.sessionGoal) * 100, 100);
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('goalPercentage').textContent = Math.round(progress) + '%';
    
    // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    document.getElementById('totalDistance').textContent = distanceKm;
    document.getElementById('totalTime').textContent = formatTime(trackerState.currentTime);
    document.getElementById('totalCalories').textContent = trackerState.sessionCalories;
}

function updateTimerDisplay() {
    const hours = Math.floor(trackerState.currentTime / 3600);
    const minutes = Math.floor((trackerState.currentTime % 3600) / 60);
    const seconds = trackerState.currentTime % 60;
    
    document.getElementById('timerDisplay').textContent = 
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    
    if (hours > 0) {
        return `${hours}:${minutes.toString().padStart(2, '0')}`;
    }
    return `${minutes}:${(seconds % 60).toString().padStart(2, '0')}`;
}

// ============================================
// –í–ê–®–ò –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
// ============================================

function openLink(url) {
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.openLink(url);
    } else {
        window.open(url, '_blank');
    }
}

function openTelegramBotFullscreen() {
    document.getElementById('telegramBotFullscreen').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(function() {
            closeFullscreen();
        });
    }
}

function closeFullscreen() {
    document.getElementById('telegramBotFullscreen').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

// –í–∞—à–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω...
function openPriceModal() {
    document.getElementById('priceModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closePriceModal);
    }
}

function closePriceModal() {
    document.getElementById('priceModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function openStockModal() {
    document.getElementById('stockModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeStockModal);
    }
}

function closeStockModal() {
    document.getElementById('stockModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function openDirectionsModal() {
    document.getElementById('directionsModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeDirectionsModal);
    }
}

function closeDirectionsModal() {
    document.getElementById('directionsModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function openSignupModal() {
    document.getElementById('signupModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeSignupModal);
    }
}

function closeSignupModal() {
    document.getElementById('signupModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function openTestModal() {
    document.getElementById('testModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeTestModal);
    }
}

function closeTestModal() {
    document.getElementById('testModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function openContactsModal() {
    document.getElementById('contactsModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeContactsModal);
    }
}

function closeContactsModal() {
    document.getElementById('contactsModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

function openTrainersModal() {
    document.getElementById('trainersModal').classList.add('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.BackButton.show();
        Telegram.WebApp.BackButton.onClick(closeTrainersModal);
    }
}

function closeTrainersModal() {
    document.getElementById('trainersModal').classList.remove('active');
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.enableVerticalSwipes();
        Telegram.WebApp.BackButton.hide();
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
document.querySelectorAll('.modal-overlay').forEach(modal => {
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            if (this.id === 'priceModal') closePriceModal();
            else if (this.id === 'stockModal') closeStockModal();
            else if (this.id === 'directionsModal') closeDirectionsModal();
            else if (this.id === 'signupModal') closeSignupModal();
            else if (this.id === 'testModal') closeTestModal();
            else if (this.id === 'contactsModal') closeContactsModal();
            else if (this.id === 'trainersModal') closeTrainersModal();
            else if (this.id === 'fitnessTrackerModal') closeFitnessTracker();
        }
    });
});

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function createStars() {
    const starsContainer = document.getElementById('stars');
    const starsCount = 160;
    
    for (let i = 0; i < starsCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        
        const size = Math.random() * 2 + 1;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 3;
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${posX}%`;
        star.style.top = `${posY}%`;
        star.style.animationDelay = `${delay}s`;
        
        starsContainer.appendChild(star);
    }
}

function initWapiAuth() {
    if (typeof Listok !== 'undefined') {
        Listok.init({
            containerId: 'listokWidgetContainer',
            configId: '91afda9e057d0c742cda59a22cd5bdf4',
            onAuth: function(userData) {
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
            },
            onLoad: function() {
                console.log('‚úÖ WAPI –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
        });
    }
}

function openTelegramBot() {
    openLink('https://t.me/DreamTeamStudio_Bot');
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    createStars();
    initWapiAuth();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–∫–µ—Ä–∞
    loadTrackerData();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            () => {
                trackerState.hasGeolocation = true;
                updateGPSStatus('–î–æ—Å—Ç—É–ø–µ–Ω', true);
            },
            () => {
                updateGPSStatus('–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ', false);
            },
            { timeout: 2000 }
        );
    }
    
    console.log('üöÄ Mini App –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–≤–∞–π–ø–æ–≤
document.addEventListener('touchmove', function(e) {
    if (e.scale !== 1) {
        e.preventDefault();
    }
}, { passive: false });

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
setInterval(function() {
    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        if (!Telegram.WebApp.isExpanded) {
            Telegram.WebApp.expand();
            Telegram.WebApp.disableVerticalSwipes();
        }
    }
}, 1000);
</script>
</body>
</html>
